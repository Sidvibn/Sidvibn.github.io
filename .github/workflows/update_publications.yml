# name: Update publications from ADS

# on:
#   schedule:
#     - cron: "0 0 * * 0"   # weekly
#   workflow_dispatch:

# jobs:
#   build:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4

#       - name: Query ADS
#         env:
#           ADS_TOKEN: ${{ secrets.ADS_TOKEN }}
#         run: |
#           python - << 'EOF'
#           import requests, json

#           headers = {"Authorization": f"Bearer {headers := None}"}
#           headers = {"Authorization": f"Bearer {__import__('os').environ['ADS_TOKEN']}"}

#           query = "orcid:0009-0000-3694-8993"   # <-- PUT YOUR ORCID HERE
#           url = "https://api.adsabs.harvard.edu/v1/search/query"

#           params = {
#               "q": query,
#               "fl": "title,year,pub,bibcode,author",
#               "rows": 100,
#               "sort": "date desc"
#           }

#           r = requests.get(url, headers=headers, params=params)
#           docs = r.json()["response"]["docs"]

#           with open("publications.json", "w") as f:
#               json.dump(docs, f, indent=2)
#           EOF

#       - name: Commit JSON
#         run: |
#           git config user.name "github-actions"
#           git config user.email "actions@github.com"
#           git add publications.json
#           git commit -m "Update publications"
#           git push

name: Update publications

on:
  schedule:
    - cron: "0 3 * * *"   # daily
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Generate publications.json
        run: |
          cat > publications.json << 'EOF'
          [
            {
              "title": ["Example Paper"],
              "year": 2025,
              "pub": "ApJ",
              "bibcode": "2025ApJ...XXX..123A"
            }
          ]
          EOF

      - name: Commit and push
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add publications.json
          git commit -m "Update publications" || echo "No changes"
          git push
